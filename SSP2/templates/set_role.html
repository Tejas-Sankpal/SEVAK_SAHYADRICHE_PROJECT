{% extends 'dashboard.html' %}
{% load static %}

{% block title %}Add Role{% endblock %}

{% block extra_css %}
<style>
/* Validation styles - integrated with global design system */
.error {
  color: #e53e3e;
  font-size: 0.875rem;
  margin-top: 0.5rem;
  display: block;
  font-weight: 500;
}

/* Valid input → green border + ✔ */
input.valid, select.valid {
  border-color: #48bb78 !important;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='20' height='20'><text x='0' y='15' font-size='18' fill='%2348bb78'>✔</text></svg>") !important;
  background-repeat: no-repeat !important;
  background-position: right 8px center !important;
  background-size: 20px 20px !important;
}

/* Invalid input → red border + ✖ */
input.invalid, select.invalid {
  border-color: #e53e3e !important;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='20' height='20'><text x='0' y='15' font-size='18' fill='%23e53e3e'>✖</text></svg>") !important;
  background-repeat: no-repeat !important;
  background-position: right 8px center !important;
  background-size: 20px 20px !important;
}
</style>
{% endblock %}

{% block content %}

<div class="container-fluid">
  <h1>Add Role</h1>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

    <form id="SetRoleForm" action="/save_role/" method="post">
        {% csrf_token %}

        <div class="mb-3">
            <label>Role Name:</label>
            <input type="text" name="rolenm" class="form-control">
            <small id="roleNameError" class="error"></small>
        </div>

        <div class="mt-4">
          <button type="submit" class="btn btn-success">Set Role</button>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/myjs_script.js' %}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("SetRoleForm");

    // --- Name Validation ---
    function validateName() {
      const name = form.rolenm.value.trim();
      const errorEl = document.getElementById("roleNameError");

      if (name === "") {
        errorEl.textContent = "Name is required";
        form.rolenm.classList.add("invalid");
        form.rolenm.classList.remove("valid");
        return false;
      } else if (name.length < 2 || name.length > 50) {
        errorEl.textContent = "Name must be between 2 and 50 characters";
        form.rolenm.classList.add("invalid");
        form.rolenm.classList.remove("valid");
        return false;
      } else {
        errorEl.textContent = "";
        form.rolenm.classList.add("valid");
        form.rolenm.classList.remove("invalid");
        return true;
      }
    }

    form.rolenm.addEventListener("input", validateName);

     form.addEventListener("submit", function (e) {
      let isValid = true;

      if (!validateName()) isValid = false;

      if (!isValid) e.preventDefault();
    });

});
</script>

{% endblock %}