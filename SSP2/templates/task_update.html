{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- customized css -->
  <link href="{% static 'css/mystyle.css' %}" rel="stylesheet" type="text/css">

</head>
<body class="container mt-5">

<h1>Create Task !</h1>
<br>
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
<br>
<form action="{% url 'update_assign_task_to_leader' %}" method="post" id="AdminTaskAssign">
  {% csrf_token %}

  <input >

  <div>
    <label for="task_title">Task Title:</label>
    <input type="text" name="task_title" class="form-control">
    <div id="taskTitleError" class="error"></div>
  </div>

  <div>
    <label for="task_description">Task Description:</label>
    <textarea name="task_description" class="form-control" rows="3"></textarea>
    <div id="taskDescError" class="error"></div>
  </div>

  <!-- Group Dropdown -->
  <div>
    <label for="group_id">Select Group:</label>
    <select id="group_id" name="group_id" class="form-control">
      <option value="">--Select Group--</option>
      {% for group in group_name %}
         <option value="{{ group.id }}">{{ group.group_name }}</option>
      {% endfor %}
    </select>
    <div id="taskGroupIdError" class="error"></div>
  </div>

  <!-- Leader Dropdown (auto-updated via JS) -->
  <div>
    <label for="leader_id">Select Leader:</label>
    <select id="leader_id" name="leader_id" class="form-control">
      <option value="">--Select Leader--</option>
      {% for leader in leader_name %}
         <option value="{{ leader.id }}">{{ leader.volunteer_name }}</option>
      {% endfor %}
    </select>
    <div id="taskLeaderIdError" class="error"></div>
  </div>

  <div>
    <label for="task_deadline">Task Deadline:</label>
    <input type="datetime-local" name="task_deadline" class="form-control">
    <div id="taskDeadlineError" class="error"></div>
  </div>

  <div>
    <label for="Admin_id">Select Your Name:</label>
    <select id="Admin_id" name="Admin_id" class="form-control">
      <option value="">--Select Your Name--</option>
      {% for admin in admin_name %}
         <option value="{{ admin.id }}">{{ admin.volunteer_name }}</option>
      {% endfor %}
    </select>
    <div id="taskAdminIdError" class="error"></div>
  </div>

  <!-- Hidden Task status -->

  <input type="hidden" name="task_status" value="Pending">

  <button type="submit" class="btn btn-primary mt-3">Create Task</button>
  <a href="/task_dashboard/" class="btn btn-secondary mt-3">Back </a>
</form>
<!--Ajax for name of group leader with group name-->
<script>
document.addEventListener("DOMContentLoaded", function() {

  const groupSelect = document.getElementById("group_id");
  const leaderSelect = document.getElementById("leader_id");

  // When group changes → update leader
  groupSelect.addEventListener("change", function() {
    const groupId = this.value;
    if (!groupId) return;

    fetch(`/get_leader_by_group/${groupId}/`)
      .then(response => response.json())
      .then(data => {
        leaderSelect.innerHTML = `<option value="${data.leader_id}">${data.leader_name}</option>`;
      })
      .catch(error => console.error("Error fetching leader:", error));
  });

  // When leader changes → update group
  leaderSelect.addEventListener("change", function() {
    const leaderId = this.value;
    if (!leaderId) return;

    fetch(`/get_group_by_leader/${leaderId}/`)
      .then(response => response.json())
      .then(data => {
        groupSelect.innerHTML = `<option value="${data.group_id}">${data.group_name}</option>`;
      })
      .catch(error => console.error("Error fetching group:", error));
  });

});

</script>

<script src="{% static 'js/myjs_script.js' %}"></script>
</body>
</html>

