{% extends 'dashboard.html' %}
{% load static %}

{% block title %}Assigned Tasks{% endblock %}
{% block extra_css %}


<style>
table.table tbody tr.clickable-row {
    cursor: pointer;
    transition: background-color 0.25s;
}

table.table tbody tr.clickable-row:hover {
    background-color: red !important;
}

</style>
{% endblock %}
{% block content %}
<div class="container-fluid">
  <h1>See Assigned Tasks</h1>

<!-- Search Filter -->
<form id="filterForm" class="row g-3 mb-4">
    <div class="col-md-3">
        <select name="filter_type" class="form-control" id="filterType">
            <option value="title">Task Title</option>
            <option value="group">Group Name</option>
            <option value="status">Status</option>
            <option value="created_at">Created Date</option>
        </select>
    </div>

    <div class="col-md-4">
        <input type="text" name="filter_value" class="form-control"
               id="filterValue" placeholder="Enter search value">
    </div>

    <div class="col-md-1">
        <button type="button" class="btn btn-warning w-100" id="clearBtn">Clear</button>
    </div>
</form>

<!-- Main Table (Only One) -->
<table class="table table-striped table-bordered mt-3">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Assigned Group</th>
        <th>Task Created At</th>
        <th>Task Status</th>
        <th>Rejection Reason</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody id="taskResults">
        {% include "task_search_result.html" with tasks=tasks %}
    </tbody>
</table>

</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/myjs_script.js' %}"></script>

<script>
function activateClickableRows() {
    document.querySelectorAll(".clickable-row").forEach(row => {
        row.addEventListener("click", function () {
            window.location = this.dataset.href;
        });
    });
}
activateClickableRows();

let typingTimer;
let delay = 30;

// Fetch via AJAX
function fetchResults() {
    let type = document.getElementById("filterType").value;
    let value = document.getElementById("filterValue").value;

    fetch(`/task_search_result/?filter_type=${type}&filter_value=${value}`)
        .then(res => res.text())
        .then(html => {
            document.getElementById("taskResults").innerHTML = html;
            activateClickableRows();
        });
}

document.getElementById("filterValue").addEventListener("keyup", function () {
    clearTimeout(typingTimer);
    typingTimer = setTimeout(fetchResults, delay);
});

document.getElementById("filterType").addEventListener("change", fetchResults);

document.getElementById("clearBtn").addEventListener("click", function () {
    document.getElementById("filterValue").value = "";
    fetchResults();
});
</script>
{% endblock %}
